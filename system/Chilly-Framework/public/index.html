<!DOCTYPE html>
<html>
<head>
    <title>Chilly Framework Boilerplate</title>
</head>
<body>
<h1>Chilly Framework Boilerplate</h1>
<p>This is an example of how to use Chilly Framework. In this basic example an extra chat channel is defined. The flow goes like this:</p>
<ol>
    <li>Define extra channels ("update" channel is created by default)</li>
    <li>Define onUpdate actions for update channel pushes</li>
    <li>Register a user with Chilly by using the login request (implement in actions.js)</li>
    <li>When login is successful, call Chilly.init() and Chilly.longPoll(). This starts the listening for updates.</li>
    <li>Use Chilly.request to send updates and implement broadcast on backend in actions.js</li>
</ol>
<h2>On login</h2>
<p>Chilly framework requires all users to be in a "Game" context. You can also think of this as rooms. All players in the same game will have the messages synced between them. Check actions.js for an example of how to broadcast to all users in a game.</p>
<p>Game implementation can be found in models.js and should be expanded with custom features.</p>
<h2>About this example</h2>
<p>All output is sent to the console!</p>
<p>It logs in the user and starts polling for updates. After 5 seconds it broadcasts 3 different events. 1 on the chat channel, 2 on the update channel. If you open two browsers, the messages should be mirrored between them.</p>

<h2>For additional questions go to the <a href="http://chillyframework.com/discussion/">Chilly Framework discussion page</a>.</h2>

<script src="/js/libraries/chilly-0.2.js"></script>
<script type="text/javascript">
    window.onload = function() {

        /**
         * Definitions
         */
        // defines a new channel "chat", define what happens when a chat event is received
        Chilly.listen('chat', function(msg){
            console.log('Chat event received.');
            console.log(msg);
        });

        // define an event on the update channel
        Chilly.onUpdate('sum', function(data) {
            console.log('Sum update received.');
            console.log(data);
        });

        // one more event on the update channel
        Chilly.onUpdate('multiply', function(data) {
            console.log('Multiply update received.');
            console.log(data);
        });

        /**
         * Login
         */
        // login is required to register a player with Chilly
        // password implementation is up to the user
        Chilly.request('login', {
            data: {
                username: 'user' + Math.floor(Math.random()*1001) // random number for testing in multiple browsers at the same time
            },
            success:function (data) {
                Chilly.init(); // triggers init event
                Chilly.longPoll(); // start listening to defined channels for updates (update [default] + chat [user defined])
            },
            error: function(data) {
                // @verification must be added to check if username / password was correct
                // if already logged in:
                Chilly.init(); // triggers init event
                Chilly.longPoll(); // start listening to defined channels for updates (update [default] + chat [user defined])
            }
        });


        /**
         * Broadcasting
         */
        // broadcast to all members of the game in 5s
        setTimeout(function(){

            // send chat example (triggers chat chanel update)
            Chilly.request('sendChat', {
                data: {
                    message: 'This is a broadcasted message!!!'
                },
                success: function (data) {
                    console.log('Message sent successfully.');  // this can happen after the result is received due to the nature of ajax
                }
            });


            // game update example (triggers onUpdate)
            Chilly.request('sum', {
                data: {
                    number1: 5,
                    number2: 6
                },
                success: function(data) {
                    console.log('Sum request sent successfully.'); // this can happen after the result is received due to the nature of ajax
                }
            });


            // another game update example (triggers onUpdate)
            Chilly.request('multiply', {
                data: {
                    number1: 2,
                    number2: 3
                },
                success: function(data) {
                    console.log('Multiply request sent successfully.'); // this can happen after the result is received due to the nature of ajax
                }
            });
        }, 5000);
    };
</script>
</body>
</html>